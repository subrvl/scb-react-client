import React, { useState } from "react";
import css from "./Otp.module.css";
import { useNavigate } from "react-router-dom";
import axios from "axios";

export default ({ setHeader }) => {
  const url = "http://localhost:8080/";
  const [otp, setOtp] = useState("");
  let navigate = useNavigate();

  const generateOtp = async () => {
    try {
      const response = await axios.get(url + "genOtp");
      const { status } = await response.data;
      status !== "success" && alert("Otp generation failed");
    } catch (error) {
      alert("Error Occured - ", error);
    }
  };

  const onSubmit = async () => {
    if (!otp || isNaN(otp)) {
      alert("OPT is invalid");
      return;
    }

    const response = await axios.post(url + "valOtp", {
      otp,
    });
    const { status } = await response.data;
    alert(status)

    status !== "success" ? alert("OPT is invalid") : navigate("/home");
  };

  return (
    <div className={`${css.containerpart}`}>
      <div className={`${css.otpPart}`}>
        <div className={`${css.maincard}`}>
          <img className={`${css.img}`} src="/icons/scb-logo.png" />
          <h6 className={`${css.headline}`}>2FA Password</h6>
          <p className={`${css.para1}`}>
            2FA stands for Two Factor Authentication is a security system that
            requires two separate,distinct forms of identification in order to
            access something.
          </p>
          <a onClick={generateOtp} href="#" className={`${css.otplabel}`}>
            Click to generate OTP
          </a>
          <div className={`${css.para2}`}>
            This will be sent to the number associated with your account
          </div>
          <div className={`${css.otpTop}`}>
            <input
              value={otp}
              className={`${css.inputText}`}
              type="text"
              placeholder="Enter OTP"
              onChange={(e) => setOtp(e.target.value)}
            />
          </div>
          <span>
            00 : 00 to{" "}
            <a onClick={generateOtp} href="#">
              resend OTP
            </a>
          </span>
          <div className={`${css.ctrl}`}>
            <button className={`${css.cancel}`}>Cancel</button>
            <button onClick={onSubmit} className={`${css.submit}`}>
              Submit
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};
